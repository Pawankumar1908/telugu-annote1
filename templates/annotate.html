<link rel="stylesheet" href="/static/style.css">

<div class="cosmic-wrapper">
  <div class="cosmic-card">

    <h1 class="user-name">{{ name }}</h1>
    <p class="contrib-count">Contributions: {{ count }}</p>

    <!-- Telugu -->
    <div class="input-row">
        <input id="telugu" placeholder="Proverb (Telugu)">
        <button type="button" class="tick-btn" onclick="verifyField('telugu')">âœ”</button>
    </div>
    <small id="telugu-status" class="status-text"></small>

    <!-- English -->
    <div class="input-row">
      <input id="english" placeholder="Proverb (English / Roman)">
      <button type="button" class="tick-btn" onclick="verifyField('english')">âœ”</button>
    </div>
    <small id="english-status" class="status-text"></small>

    <!-- Meaning -->
    <textarea id="meaning" placeholder="Meaning (English)"></textarea>

    <!-- Keywords -->
    <input id="keywords" placeholder="Keywords (comma separated)">

    <form method="post" onsubmit="syncHiddenFields()">
      <input type="hidden" name="proverb_telugu" id="h_telugu">
      <input type="hidden" name="proverb_english" id="h_english">
      <input type="hidden" name="meaning_english" id="h_meaning">
      <input type="hidden" name="keywords" id="h_keywords">
      <button class="submit-btn">Submit Contribution</button>
    </form>

    <a href="/logout">
      <button class="logout-btn">Logout</button>
    </a>

  </div>
</div>

<script>

async function verifyField(field){

  const telInput = document.getElementById("telugu");
  const engInput = document.getElementById("english");
  const telStatus = document.getElementById("telugu-status");
  const engStatus = document.getElementById("english-status");
  const input = document.getElementById(field);
  const status = document.getElementById(field + "-status");

  const value = input.value.trim();
  if(!value) return;

  // Reset UI
  telInput.classList.remove("ok","error");
  engInput.classList.remove("ok","error");
  telStatus.innerText = "";
  engStatus.innerText = "";

  const res = await fetch("/verify",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({value:value})
  });

  const data = await res.json();

  if(data.status === "exists"){
      input.classList.add("error");
      status.innerText = "Already exists in database";

      telInput.value = data.data.proverb_telugu || "";
      engInput.value = data.data.proverb_english || "";
      meaning.value = data.data.meaning_english || "";
      keywords.value = data.data.keywords || "";

  }else{

      input.classList.add("ok");
      status.innerText = "New entry";

      // ðŸ”¥ AUTO CONVERSION
      if(field === "telugu"){
          engInput.value = data.converted;
      }

      if(field === "english"){
          telInput.value = data.converted;
      }

      meaning.value = "";
      keywords.value = "";
  }
}

function syncHiddenFields(){
    h_telugu.value = telugu.value;
    h_english.value = english.value;
    h_meaning.value = meaning.value;
    h_keywords.value = keywords.value;
}

</script>
